#!/usr/bin/env python
import os
import applescript
import public
import vlc.fullscreen
import vlc.time
import vlc.volume


@public.add
def tell(code):
    """execute applescript `tell application "VLC" ...`"""
    return applescript.tell.app("VLC", code)._raise().out


@public.add
def duration():
    """return current video duration (seconds)"""
    if pid():
        return int(tell('duration of current item'))


@public.add
def path():
    """get current video path"""
    return tell('path of current item')


@public.add
def play(path=None):
    """open/continue play video"""
    if path:
        tell('open "%s"' % path)
    else:
        if not playing():
            tell('play')


@public.add
def pause():
    """pause current video"""
    if playing():
        tell('pause')


@public.add
def playing():
    """return True if video is playing"""
    return "true" in tell('playing')


"""
process functions
"""


@public.add
def activate():
    """open VLC and make it frontmost"""
    vlc.tell('activate')


@public.add
def pid():
    """VLC.app pid"""
    _pid = os.popen("pgrep VLC").read().strip()
    if _pid:
        return _pid


@public.add
def quit():
    """safe quit VLC"""
    if pid():
        vlc.tell("quit")


@public.add
def kill():
    """kill VLC.app process"""
    _pid = pid()
    if _pid:
        os.popen("kill -9 %s 2>&1" % _pid)
